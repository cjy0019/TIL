# HTTP에 기능을 추가한 프로토콜

- http는 사용하기 매우 편리하지만 시간이 지남에 따라 더 많은 기능들을 필요로 하게 되었다. 추가된 프로토콜들에 대해 알아보자.



## 1. HTTP를 기반으로 하는 프로토콜

HTTP는 처음에 단순히 `sample.html` 문서를 전달하는 용도로 만들어졌지만, 시대가 지나면서 쇼핑 사이트, SNS등에서 널리 쓰이게 되면서 많은 기능들을 요구하게 되었다. 

HTTP 프로토콜의 한계점들이 존재하는 데 이를 해결하기 위해 새로운 프로토콜을 만들 수도 있지만, 웹 브라우저가 널리 퍼져있기 때문에 HTTP를 무시할 수는 없고 HTTP를 기반으로 기능을 추가하는 형태로 발전되었다.



## 2. HTTP의 병목 현상을 해소하는 SPDY

먼저, 병목 현상이라는 단어에 대해 알아보자.

> 병목 현상(bottleneck) : 전체 시스템의 성능이나 용량이 하나의 구성 요소로 인해 제한을 받는 현상을 말한다.
>
> 컴퓨터 프로그래밍에서 부르는 소프트웨어 성능 분석이라는 것은 병목 현상을 추적하는 일을 뜻하는데 간단히 말해서 전반적인 알고리즘 효율성을 개선해서 코드가 되도록 빨리 수행될 수 있게 만드는 것이다.

2010년에 발표한 구글의 스피디는 병목 현상을 해소하고 로딩 시간을 단축하는 목표를 세웠다.



### 2.1 HTTP의 병목 현상

HTTP는 다량의 리퀘스트가 발생하면 불필요한 통신에 의해서 처리속도가 느려지는 병목 현상이 일어난다.

다음과 같은 사양들은 HTTP의 병목현상을 일으킨다.

- 1개의 커넥션으로 1개의 리퀘스트만 보낼 수 있다.
- 리퀘스트는 클라이언트에서만 시작할 수 있다. 리스폰스 받는 것은 불가능하다.
- 리퀘스트/리스폰스 헤더를 압축하지 않은 채로 보낸다. 헤더의 정보가 많을수록 지연이 심하다.
- 장황한 헤더를 보낸다. 매번 같은 헤더를 보내는 것은 낭비다.
- 데이터 압축을 임의로 선택할 수 있다. 압축해서보내는 것이 강제는 아니다.



**Ajax에 의한 해결**

Ajax는 JS의 라이브러리중 하나이며 Asynchronous Javascript And Xml의 약자이다. 브라우저가 가지고 있는 XMLHttpRequest 객체를 이용해서 전체 페이지를 새로 고치지 않고도 페이지의 일부분만을 위한 데이터를 로드하는 기법이고 JS를 사용한 비동기 통신 기술이다. 쉽게 말해 JS를 통해 서버에 데이터에 요청하는 기술을 말한다.

- 페이지 새로고침 없이 서버에 요청
- 서버로부터 데이터를 받고 작업을 수행

그러나, Ajax 또한 실시간으로 서버에서 정보를 취득하려고 할 때, 대량의 리퀘스트가 발생한다는 HTTP의 프로토콜이 가지는 근본적인 문제를 해결할 수는 없다.



**Comet에 의한 방법**

원래는 리퀘스트가 오면 바로 리스폰스를 바로 반환하지만, Comet에서는 리스폰스를 보류 상태로 해두고, 서버가 갱신되었을 때에 리스폰스를 반환한다. 즉, 서버에서 갱신된 콘텐츠가 있으면 바로 클라이언트에 반영할 수 있다.

**그러나 콘텐츠를 실시간으로 갱신할 수는 있지만 리스폰스를 보류하기 위해서 커넥션을 유지하는 시간이 길어진다.**



### 2.2 SPDY 설계와 기능

Ajax와 Comet등의 기술을 사용해서 어느 정도 개선되었지만, HTTP라는 프로토콜의 제약을 없앨 수는 없기 때문에 프로토콜 레벨에서의 개선이 필요하다. 이 때 나온 것이 SPDY이다. 새로운 산업 표준을 만들 정도로 웹 속도에 큰 기여를 하고 있다.

SPDY는 'speedy'라는 단어를 기반으로 Google이 만든 조어로, Google이 자신들의 'Make the Web Faster'노력의 하나로 제안한 새로운 프로토콜이다. 

![spdy1](https://d2.naver.com/content/images/2015/06/helloworld-140351-1.png)

SPDY가 세션 계층으로서 그 사이에 들어감으로써 데이터의 흐름을 제어하지만, HTTP의 커넥션은 확립되어 있습니다. 그래서 HTTP의 GET이나 POST 같은 메소드나 쿠키, HTTP 메시지를 사용할 수 있습니다.



특징

- 항상 TLS 위에서 동작한다. 따라서 HTTPS로 작성된 웹 사이트만 적용 가능하다.

TLS는 SSL의 다음 버전이다.

- HTTP 헤더 압축

  HTTP 헤더에는 요청마다 반복되는 내용이 많으므로 헤더 압축만으로도 충분한 성능 향상을 기대할 수 있다. Google의 발표에 따르면 HTTP 헤더 압축으로 최초 요청 시에도 10 ~ 35%의 크기를 감소시킬 수 있고 여러 번 요청이 있을 경우에는 80~97% 까지 헤더의 크기를 감소시킬 수 있다.

- 바이너리 프로토콜

  프레임을 텍스트가 아닌 바이너리로 구성하므로 파싱이 더 빠르고 오류 발생 가능성이 낮다.

- multiplexing

  하나의 커넥션 안에서 다수의 독립적인 스트림을 동시에 처리한다. 따라서 하나의 커넥션을 한 번에 하나만의 요청을 처리하며 요청에 대한 응답이 순차적으로 이뤄지는 HTTP와 달리 적은 수의 커넥션으로 다수의 요청, 응답을 동시에 처리 할 수 있다. FIFO 방식

  > 스트림 : 스트림이란 실제의 입력이나 출력이 표현된 데이터의 이상화된 흐름을 의미한다. 즉 스트림은 운영체제에 의해 생성되는 가상의 연결 고리를 의미하고 중간 매개자 역할을 한다.![스트림](http://www.tcpschool.com/lectures/img_c_stream.png)

- Full-duplex interleaving과 스트림 우선순위

  한 스트림이 진행 중이더라도 다른 스트림이 끼어드는 것을 허용하고 스트림의 우선순위 설정도 지원하므로, 우선순위가 낮은 데이터 전송 도중에 우선순위가 높은 데이터가 끼어들어서 더 빨리 전달되게 할 수 있다.

- Server Push

  Comet, 롱 폴링 같은 것과는 달리 클라이언트의 요청이 없어도 서버에서 콘텐츠를 직접 push 할 수 있다. 서버 측은 클라이언트 측에서 리퀘스트를 기다리지 않고 데이터를 보낼 수 있다.

- 웹 사이트를 재작성할 필요가 없다.

  server push와 같이 추가 구현을 요구하는 기능을 제외하면, SPDY 적용 자체를 위해 웹 사이트 자체가 바뀌어야 할 필요는 없다. 다만 브라우저와 서버가 SPDY를 지원해야만 한다. 또한 spdy:// 같은 프로토콜 스킴이 존재하지 않는다.



### 2.3 브라우저에서 양방향 통신을 하는 WebSocket

웹 소켓은 사용자의 브라우저와 서버 사이의 인터액티브 통신 세션을 설정할 수 있게 하는 고급 기술입니다. 개발자는 웹 소켓 API를 통해 서버로 메시지를 보내고 서버의 응답을 위해 서버를 폴링하지 않고도 이벤트 중심 응답을 받는 것이 가능합니다.

> 폴링 : 하나의 장치가 충돌 회피 또는 동기화 처리를 목적으로 다른 장치의 상태를 주기적으로 검사하여 일정한 조건을 만족할 때 송수신 등의 자료 처리를 하는 방식을 말한다.

웹 소켓을 통해 접속을 한번 확립하면 그 뒤에는 클라이언트와 서버 어느쪽에서도 송신을 할 수가 있게 된다.



특징

- 서버 푸시 기능

  서버에서 클라이언트에 데이터를 푸시하는 기능을 제공한다.

- 통신량 삭감

  한번 접속하면 유지하려고 하기 때문에 HTTP에 비해서 자주 접속을 하는 오버헤드가 적어지고 또 헤더의 사이즈도 작아지기 때문에 통신량을 줄 일 수 있다.

  > 위키백과에 검색해보면 오버헤드(overhead)는 어떤 처리를 하기 위해 들어가는 간접적인 처리 시간 및 메모리등을 말합니다.

- 핸드쉐이크/리퀘스트

  Upgrade 헤더 필드를 사용해서 프로토콜을 변경하는 것으로 핸드쉐이크를 한다.

  sec-websocket-protocol : UUID 32byte 값을 Base64 인코딩을 통해 변환한다. 매직키로 불린다.

- 핸드쉐이크/리스폰스

  101 Switching Protocols 반환

  

  1) Sec-WebSocket-Key 값 디코딩해서 검증한다.

  2) GUID(258EAFA5-E914-47DA-95CA-C5AB0DC85B11)를 붙여서 문자열을 만든다.

  3) GUID가 붙은 Key를 SHA1 HASHING -> Binaray 형식으로 만든다.

  4) Binary SHA1 Hashing 된 Key 값을 다시 Base64 Encoding 을 거친다.



## 3. HTTP/2

HTTP2.0 이라고도 불리는 HTTP/2는 2015년 IETF에 의해 공식 발표된 HTTP/1.1의 차기 버전이다.

> IETF: Internet Engineering Task Force, 국제 인터넷 표준화 기구를 의미하며, 인터넷의 운영, 관리, 개발에 대해 협의하고 프로토콜과 구조적인 사안들을 분석하는 인터넷 표준화 작업기구

SPDY라는 구글의 비표준 개방형 네트워크 프로토콜에 기반한다.![img](https://media.vlpt.us/images/taesunny/post/eddc9c22-7d46-4899-877c-f8ce751609d5/image.png)

- Stream: 구성된 연결 내에서 전달되는 바이트의 양방향 흐름, 하나 이상의 메시지가 전달 가능하다
- Message: 논리적 요청 또는 응답 메시지에 매핑되는 프레임의 전체 시퀀스이다.
- Frame: HTTP/2에서 통신의 최소 단위. 각 최소 단위에는 하나의 프레임 헤더가 포함된다. 이 프레임 헤더는 최소한으로 프레임이 속하는 스트림을 식별한다. HEADERS Type Frame, DATA Type Frame이 존재한다.



특징

- HTTP Header Data Compression (HTTP 헤더 데이터 압축)

  HTTP/2에서는 Huffman Coding을 사용하는 HPACK이라는 Header 압축방식을 이용하여 데이터 전송 효율을 높였다.

  > Huffman Coding 방식: 데이터 문자의 빈도에 따라서 다른 길이의 부호를 사용하는 알고리즘

- server push

  클라이언트가 요청 하지 않은 JavaScript, CSS, Font, 이미지 파일 등과 같이 필요하게 될 특정 파일들을 서버에서 단일 HTTP 요청 응답 시 함께 전송할 수 있다.

- HOL blocking 문제 해결

  HTTP/1.1 까지는 한번에 하나의 파일만 전송이 가능했다. 이로인해 여러 파일을 전송 할 경우, 선행하는 파일의 전송이 늦어지면, 전체 파일 전송의 시간이 늘어나는 문제가 발생하였다. HTTP/2에서는 여러 파일을 한번에 병렬 전송하여, 이러한 문제를 해결하였다.![img](https://media.vlpt.us/images/taesunny/post/8ba0ec32-1e59-4ffc-a801-21502f44e8a4/image.png)

stream이 뒤섞여서 전송 될 경우, stream number를 이용해 수신측에서 재조합된다.

- Stream 우선 순위

  HTTP 메시지가 많은 개별 프레임으로 분할될 수 있고 여러 스트림의 프레임을 다중화(Multiplexing)할 수 있게 되면서, 스트림들의 우선순위를 지정할 필요가 생겼다. 클라이언트는 우선순위 지정을 위해 ‘우선순위 지정 트리'를 사용하여 서버의 스트림처리 우선순위를 지정할 수 있다. 서버는 우선순위가 높은 응답이 클라이언트에 우선적으로 전달될 수 있도록 대역폭을 설정한다.







# 웹 콘텐츠에서 사용하는 기술

본래 HTTP를 사용한 웹 구조는 사전에 준비된 콘텐츠를 클라이언트의 리퀘스트에 맞게 반환하는 것인데 웹이 보급됨에 따라 프로그램이 HTML 등의 콘텐츠를 생성할 필요가 생겼다.



### CGI

과거에는 클라이언트에서 요청하면 hello.html 이라는 문서만 보내줄 수 있었다면 CGI를 이용하면 사용자에 맞게 동적으로 콘텐츠를 구성할 수 있다.

즉 Web Server와 프로그램 사이의 규약이라고 생각하면 되고 CGI는 C, PHP, perl 등의 언어가 사용된다.



### 서블릿

서블릿은 서버 상에 HTML 등의 동적 콘텐츠를 생성하기 위한 프로그램을 가리킨다. CGI는 리퀘스트 마다 프로그램을 가동하기 때문에 대량의 액세스가 있을 때 웹 서버에 부하가 걸리지만 서블릿은  웹 서버와 같은 프로세스 속에서 동작하기 때문에 비교적 부하를 작게 동작시킬 수 있다. 이를 실행시키는 환경을 서블릿 컨테이너라고 부른다.



### XML

목적에 맞게 확장이 가능한 범용적으로 사용할 수 있는 마크업 언어이다. XML을 사용함으로써 인터넷을 통해 데이터 공유를 용이하게 하는 목적으로 하고 있다.



### JSON

경량 데이터 기술 언어로서 JS에 있어서 오브젝트 표기법을 바탕으로 하고 있다. 

- false
- null
- true
- object
- array
- number
- string

XML에 비해 함축적으로 최소한의 정보만을 가지고 있기 때문에, XML에 비해 용량이 작고 그만큼 빠른 속도를 가지고 있다.



### RSS

https://thenextweb.com